<!DOCTYPE html>
<html>
  <title>JQuery UI Basic</title>
  <meta charset="UTF-8">
  <link href="css/base/jquery-ui-1.10.4.custom.css" rel="stylesheet"/>
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="js/jquery-ui-1.10.4.custom.min.js"></script>
  <script src="js/autosize.js"></script>
  <script src="js/jquery.cookie.js"></script>
    <style>
    body {font-size: 70%; font-family: "Trebuchet MS", sans-serif;}
    h1 {text-align: center;}
    input[type="text"], label{
      margin-bottom: 12px; padding: .4em;
      width: 95%;
    }
    textarea {margin-bottom: 12px; padding: .4em;
    width: 95%; height: 50%;}
    #box {padding: 5px; width:70%; margin-left: 150px;}
    #box h1{ margin: 0; padding: 5px; text-align: center;}
  </style>
  <script>
//아래 버튼 만들어서 수정, 삭제 버튼 만들기
  function createRequest(){
    var request;
    try{
      request = new XMLHttpRequest();
    } catch (exception)
    {
      try{
        request = new ActiveXObject('Msxml2.XMLHTTP');
      } catch(innerException){
        request = new ActiveXObject('Microsoft.XMLHTTP');
      }
    }
    return request;
  }

    $(document).ready(function(){
        $('#show-data').hide();
        // 로그인 한 유저에 맞춰서 이 화면이 켜지면 리쿼스트를 보냄
      $('#edit').click(function(){
          var title =  $('#show-name').val();
          var content = $('#show-content').val();
          var showDate = $('#show-date').val();

          var loadID = document.cookie;
          var arr1 = loadID.search(';');
          var arr2 = loadID.search('//');
          loadID = loadID.slice(arr1+2,arr2);

          alert(loadID);

          title = encodeURI(title);
          content = encodeURI(content);
          showDate = encodeURI(showDate);
          loadID = encodeURI(loadID);


          var request = createRequest();
          request.open('GET','/edit?showDate='+showDate+'&title='+title +"&content="+content+ "&userID="+loadID,false);
          request.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
          request.send();

          alert(request.responseText);


      });

      $('#delete').click(function(){
        var title =  $('#show-name').val();
        var content = $('#show-content').val();
        var showDate = $('#show-date').val();

        var loadID = document.cookie;
        var arr1 = loadID.search(';');
        var arr2 = loadID.search('//');
        loadID = loadID.slice(arr1+2,arr2);

        alert(loadID);

        title = encodeURI(title);
        content = encodeURI(content);
        showDate = encodeURI(showDate);
        loadID = encodeURI(loadID);

        var request = createRequest();
        request.open('GET','/delete?showDate='+showDate+'&title='+title +"&content="+content+ "&userID="+loadID,false);
        request.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
        request.send();

        alert(request.responseText);

      });

      $('#showdata').click(function(){
          $('#show-data').show();
          $('#show-name').empty();
          $('#show-content').empty();

          var showDate = $('#show-date').val();


          var result ='';
          showDate = encodeURI(showDate);
          //쿠키를 불러옴
          var loadID = document.cookie;
          var arr1 = loadID.search(';');
          var arr2 = loadID.search('//');
          loadID = loadID.slice(arr1+2,arr2);


          showDate = encodeURI(showDate);
          var request = createRequest();
          request.open('GET','/getWork?showDate='+showDate + "&userID="+loadID,false);
          request.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
          request.send();

          //alert(request.responseText);

          if(request.responseText == '' || request.responseText == null)
          {
            result = "값이 존재하지 않습니다.";
          }
          else {
            result = request.responseText;
          }
          alert("response값:" + result);

          var arr = result.split("//");
          $('#show-name').append(arr[0]);
          $('#show-content').append(arr[1]);

          alert("일정 로딩 완료!");
      });

      $('#open-button').click(function(){
        $('#dialog').dialog('open');
      });


      $('#dialog').dialog({
        autoOpen: false,
        buttons: {
          submit: function(){
            var loadID = document.cookie;
            var arr1 = loadID.search(';');
            var arr2 = loadID.search('//');
            loadID = loadID.slice(arr1+2,arr2);

            var eventName = $('#event-name').val();
            var eventContent = $('#event-content').val();
            var eventDate = $('#event-date').val();

            eventName = encodeURI(eventName);
            eventDate = encodeURI(eventDate);
            eventContent = encodeURI(eventContent);

            var request = createRequest();
            request.open('GET','/sendWork?eventDate='+eventDate+'&eventName='+
            eventName + '&eventContent='+eventContent+'&userID='+loadID,false);
            request.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
            request.send();

            alert(request.responseText);

           },
          reset: function() {

            $('#event-name').val('');
            $('#event-content').val('');
            $('#event-date').val('');
           },
          cancel: function() {

            $('#event-name').val('');
            $('#event-content').val('');
            $('#event-date').val('');
            $('#dialog').dialog('close');
          }
        },
        modal: true
      });
      $('#event-date').datepicker({
        dateFormat: 'yy-mm-dd',
        numberOfMonths: 1
      });

      $('#show-date').datepicker({
        dateFormat: 'yy-mm-dd',
        numberOfMonths: 1
      });

    });
  </script>
</head>
<body>
  <h1 id="open-button">일정 추가하기</h1>
  <hr/>
  <div id ="dialog" title ="WScheduler">
    <h1>WScheduler 일정 등록</h1>
    <label for="event-name">일정 이름</label>
    <input id="event-name" type="text"/>
    <label for="event-content">일정 내용</label>
    <textarea id="event-content" >
    </textarea>
    <label for="event-date">날짜</label>
    <input id="event-date" type="text"/>
  </div>
  <br>
  <br>
  <br>
  <div id="box"class="ui-widget-content">
    <h1 id = "showdata" class ="ui-widget-header">일정 확인하기</h1>
    <p>
    <label for="show-date" class ="ui-widget-header">날짜</label></br>
    <input id="show-date" type="text"/>
    <div id ="show-data">
      <label for="show-name" class ="ui-widget-header">일정 이름</label></br>
      <input id="show-name" type="text"/>
      </br>
      <label for="show-content" class ="ui-widget-header">일정 내용</label></br>
      <textarea id="show-content" >
      </textarea>
      <input type= "button" id="edit" value="수정하기"/> &nbsp;
      <input type= "button" id="delete" value="삭제하기"/>
    </div>
  </p>
  </div>

</body>
</html>
